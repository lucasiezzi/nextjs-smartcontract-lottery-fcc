"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[450],{96450:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MetamaskAdapter:function(){return MetamaskAdapter}});var _ref,_ref2,asyncToGenerator=__webpack_require__(15861),classCallCheck=__webpack_require__(15671),createClass=__webpack_require__(43144),assertThisInitialized=__webpack_require__(97326),get=__webpack_require__(73237),inherits=__webpack_require__(60136),possibleConstructorReturn=__webpack_require__(82963),getPrototypeOf=__webpack_require__(61120),defineProperty=__webpack_require__(4942),regenerator=__webpack_require__(64687),regenerator_default=__webpack_require__.n(regenerator),dist=__webpack_require__(92003),dist_default=__webpack_require__.n(dist),openloginJrpc_esm=__webpack_require__(64049),custom_error=__webpack_require__(13631),httpHelpers_esm=__webpack_require__(20917),jwt_decode_esm=__webpack_require__(96245),loglevel=__webpack_require__(2043),loglevel_default=__webpack_require__.n(loglevel),CHAIN_NAMESPACES={EIP155:"eip155",SOLANA:"solana",OTHER:"other"},ADAPTER_NAMESPACES={EIP155:"eip155",SOLANA:"solana",MULTICHAIN:"multichain"},getDefaultNetworkId=function(chainNamespace){if(chainNamespace===CHAIN_NAMESPACES.EIP155||chainNamespace===CHAIN_NAMESPACES.SOLANA)return 1;throw Error("Chain namespace ".concat(chainNamespace," is not supported"))},getEvmChainConfig=function(chainId){var chainNamespace=CHAIN_NAMESPACES.EIP155;return 1===chainId?{chainNamespace:chainNamespace,chainId:"0x1",rpcTarget:"https://rpc.ankr.com/eth",displayName:"Ethereum Mainnet",blockExplorer:"https://etherscan.io/",ticker:"ETH",tickerName:"Ethereum"}:3===chainId?{chainNamespace:chainNamespace,chainId:"0x3",rpcTarget:"https://rpc.ankr.com/eth_ropsten",displayName:"Ropsten Testnet",blockExplorer:"https://ropsten.etherscan.io/",ticker:"ETH",tickerName:"Ethereum"}:4===chainId?{chainNamespace:chainNamespace,chainId:"0x4",rpcTarget:"https://rpc.ankr.com/eth_rinkeby",displayName:"Rinkeby Testnet",blockExplorer:"https://rinkeby.etherscan.io/",ticker:"ETH",tickerName:"Ethereum"}:5===chainId?{chainNamespace:chainNamespace,chainId:"0x5",rpcTarget:"https://rpc.ankr.com/eth_goerli",displayName:"Goerli Testnet",blockExplorer:"https://goerli.etherscan.io/",ticker:"ETH",tickerName:"Ethereum"}:137===chainId?{chainNamespace:chainNamespace,chainId:"0x89",rpcTarget:"https://rpc.ankr.com/polygon",displayName:"Polygon Mainnet",blockExplorer:"https://polygonscan.com",ticker:"MATIC",tickerName:"Polygon"}:80001===chainId?{chainNamespace:chainNamespace,chainId:"0x13881",rpcTarget:"https://rpc.ankr.com/polygon_mumbai",displayName:"Polygon Mumbai Testnet",blockExplorer:"https://mumbai.polygonscan.com/",ticker:"MATIC",tickerName:"Polygon"}:56===chainId?{chainNamespace:chainNamespace,chainId:"0x38",rpcTarget:"https://rpc.ankr.com/bsc",displayName:"Binance SmartChain Mainnet",blockExplorer:"https://bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain"}:97===chainId?{chainNamespace:chainNamespace,chainId:"0x61",rpcTarget:"https://rpc.ankr.com/bsc_testnet_chapel",displayName:"Binance SmartChain Testnet",blockExplorer:"https://testnet.bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain"}:25===chainId?{chainNamespace:chainNamespace,chainId:"0x19",rpcTarget:"https://rpc.cronos.org",displayName:"Cronos Mainnet",blockExplorer:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos"}:338===chainId?{chainNamespace:chainNamespace,chainId:"0x152",rpcTarget:"https://rpc-t3.cronos.org/",displayName:"Cronos Testnet",blockExplorer:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos"}:8217===chainId?{chainNamespace:chainNamespace,chainId:"0x2019",rpcTarget:"https://public-node-api.klaytnapi.com/v1/cypress",displayName:"Klaytn Mainnet",blockExplorer:"https://scope.klaytn.com",ticker:"KLAY",tickerName:"Klaytn"}:null},getSolanaChainConfig=function(chainId){var chainNamespace=CHAIN_NAMESPACES.SOLANA;return 1===chainId?{chainNamespace:chainNamespace,chainId:"0x1",rpcTarget:"https://rpc.ankr.com/solana",displayName:"Solana Mainnet",blockExplorer:"https://explorer.solana.com",ticker:"SOL",tickerName:"Solana"}:2===chainId?{chainNamespace:chainNamespace,chainId:"0x2",rpcTarget:"https://api.testnet.solana.com",displayName:"Solana Testnet",blockExplorer:"https://explorer.solana.com?cluster=testnet",ticker:"SOL",tickerName:"Solana"}:3===chainId?{chainNamespace:chainNamespace,chainId:"0x3",rpcTarget:"https://api.devnet.solana.com",displayName:"Solana Devnet",blockExplorer:"https://explorer.solana.com?cluster=devnet",ticker:"SOL",tickerName:"Solana"}:null},getChainConfig=function(chainNamespace,chainId){if(chainNamespace===CHAIN_NAMESPACES.OTHER)return null;var finalChainId=chainId?"number"==typeof chainId?chainId:parseInt(chainId,16):getDefaultNetworkId(chainNamespace);return chainNamespace===CHAIN_NAMESPACES.EIP155?getEvmChainConfig(finalChainId):chainNamespace===CHAIN_NAMESPACES.SOLANA?getSolanaChainConfig(finalChainId):null};function _createSuper$1(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var result,Super=(0,getPrototypeOf.Z)(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,getPrototypeOf.Z)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,possibleConstructorReturn.Z)(this,result)}}var Web3AuthError=function(_CustomError){(0,inherits.Z)(Web3AuthError,_CustomError);var _super=_createSuper$1(Web3AuthError);function Web3AuthError(code,message){var _this;return(0,classCallCheck.Z)(this,Web3AuthError),_this=_super.call(this,message),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"code",void 0),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"message",void 0),_this.code=code,_this.message=message||"",Object.defineProperty((0,assertThisInitialized.Z)(_this),"name",{value:"Web3AuthError"}),_this}return(0,createClass.Z)(Web3AuthError,[{key:"toJSON",value:function(){return{name:this.name,code:this.code,message:this.message}}},{key:"toString",value:function(){return JSON.stringify(this.toJSON())}}]),Web3AuthError}(custom_error.s),WalletInitializationError=function(_Web3AuthError){(0,inherits.Z)(WalletInitializationError,_Web3AuthError);var _super2=_createSuper$1(WalletInitializationError);function WalletInitializationError(code,message){var _this2;return(0,classCallCheck.Z)(this,WalletInitializationError),_this2=_super2.call(this,code,message),Object.defineProperty((0,assertThisInitialized.Z)(_this2),"name",{value:"WalletInitializationError"}),_this2}return(0,createClass.Z)(WalletInitializationError,null,[{key:"fromCode",value:function(code){var extraMessage=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new WalletInitializationError(code,"".concat(WalletInitializationError.messages[code],", ").concat(extraMessage))}},{key:"notFound",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5001,extraMessage)}},{key:"notInstalled",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5002,extraMessage)}},{key:"notReady",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5003,extraMessage)}},{key:"windowBlocked",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5004,extraMessage)}},{key:"windowClosed",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5005,extraMessage)}},{key:"incompatibleChainNameSpace",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5006,extraMessage)}},{key:"duplicateAdapterError",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5007,extraMessage)}},{key:"invalidProviderConfigError",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5008,extraMessage)}},{key:"providerNotReadyError",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5009,extraMessage)}},{key:"rpcConnectionError",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5010,extraMessage)}},{key:"invalidParams",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5011,extraMessage)}},{key:"invalidNetwork",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletInitializationError.fromCode(5013,extraMessage)}}]),WalletInitializationError}(Web3AuthError);(0,defineProperty.Z)(WalletInitializationError,"messages",{5e3:"Custom",5001:"Wallet is not found",5002:"Wallet is not installed",5003:"Wallet is not ready yet",5004:"Wallet window is blocked",5005:"Wallet window has been closed by the user",5006:"Incompatible chain namespace provided",5007:"Adapter has already been included",5008:"Invalid provider Config",5009:"Provider is not ready yet",5010:"Failed to connect with rpc url",5011:"Invalid params passed in",5013:"Invalid network provided"});var WalletLoginError=function(_Web3AuthError2){(0,inherits.Z)(WalletLoginError,_Web3AuthError2);var _super3=_createSuper$1(WalletLoginError);function WalletLoginError(code,message){var _this3;return(0,classCallCheck.Z)(this,WalletLoginError),_this3=_super3.call(this,code,message),Object.defineProperty((0,assertThisInitialized.Z)(_this3),"name",{value:"WalletLoginError"}),_this3}return(0,createClass.Z)(WalletLoginError,null,[{key:"fromCode",value:function(code){var extraMessage=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new WalletLoginError(code,"".concat(WalletLoginError.messages[code]).concat(extraMessage))}},{key:"connectionError",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletLoginError.fromCode(5111,extraMessage)}},{key:"disconnectionError",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletLoginError.fromCode(5112,extraMessage)}},{key:"notConnectedError",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletLoginError.fromCode(5113,extraMessage)}},{key:"popupClosed",value:function(){var extraMessage=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return WalletLoginError.fromCode(5114,extraMessage)}}]),WalletLoginError}(Web3AuthError);function ownKeys$1(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread$1(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys$1(Object(source),!0).forEach(function(key){(0,defineProperty.Z)(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys$1(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}(0,defineProperty.Z)(WalletLoginError,"messages",{5e3:"Custom",5111:"Failed to connect with wallet",5112:"Failed to disconnect from wallet",5113:"Wallet is not connected",5114:"Wallet popup has been closed by the user"});var MULTI_CHAIN_ADAPTERS={OPENLOGIN:"openlogin",WALLET_CONNECT_V1:"wallet-connect-v1",WALLET_CONNECT_V2:"wallet-connect-v2"},SOLANA_ADAPTERS=_objectSpread$1({TORUS_SOLANA:"torus-solana",PHANTOM:"phantom",SOLLET:"sollet",SOLLET_EXTENSION:"sollet-extension",SOLFLARE:"solflare",SLOPE:"slope"},MULTI_CHAIN_ADAPTERS),EVM_ADAPTERS=_objectSpread$1({TORUS_EVM:"torus-evm",METAMASK:"metamask",COINBASE:"coinbase"},MULTI_CHAIN_ADAPTERS),WALLET_ADAPTERS=_objectSpread$1(_objectSpread$1({},EVM_ADAPTERS),SOLANA_ADAPTERS);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,defineProperty.Z)(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}var ADAPTER_CATEGORY={EXTERNAL:"external",IN_APP:"in_app"},ADAPTER_STATUS={NOT_READY:"not_ready",READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"},ADAPTER_EVENTS=_objectSpread(_objectSpread({},ADAPTER_STATUS),{},{ADAPTER_DATA_UPDATED:"adapter_data_updated"}),BaseAdapter=function(_SafeEventEmitter){(0,inherits.Z)(BaseAdapter,_SafeEventEmitter);var hasNativeReflectConstruct,_super=(hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var result,Super=(0,getPrototypeOf.Z)(BaseAdapter);if(hasNativeReflectConstruct){var NewTarget=(0,getPrototypeOf.Z)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,possibleConstructorReturn.Z)(this,result)});function BaseAdapter(){var _this;(0,classCallCheck.Z)(this,BaseAdapter);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _this=_super.call.apply(_super,[this].concat(args)),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"adapterData",{}),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"sessionTime",86400),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"chainConfig",null),_this}return(0,createClass.Z)(BaseAdapter,[{key:"chainConfigProxy",get:function(){return this.chainConfig?_objectSpread({},this.chainConfig):null}},{key:"setChainConfig",value:function(customChainConfig){if(this.status!==ADAPTER_STATUS.READY){if(!customChainConfig.chainNamespace)throw WalletInitializationError.notReady("ChainNamespace is required while setting chainConfig");var defaultChainConfig=getChainConfig(customChainConfig.chainNamespace,customChainConfig.chainId);this.chainConfig=_objectSpread(_objectSpread({},defaultChainConfig),customChainConfig)}}},{key:"setAdapterSettings",value:function(_){}},{key:"checkConnectionRequirements",value:function(){if(this.name!==WALLET_ADAPTERS.WALLET_CONNECT_V1||this.status!==ADAPTER_STATUS.CONNECTING){if(this.status===ADAPTER_STATUS.CONNECTING)throw WalletInitializationError.notReady("Already connecting");if(this.status===ADAPTER_STATUS.CONNECTED)throw WalletLoginError.connectionError("Already connected");if(this.status!==ADAPTER_STATUS.READY)throw WalletLoginError.connectionError("Wallet adapter is not ready yet, Please wait for init function to resolve before calling connect/connectTo function");if(!this.clientId)throw WalletLoginError.connectionError("Please initialize Web3Auth with a valid clientId in constructor")}}},{key:"checkInitializationRequirements",value:function(){if(this.status!==ADAPTER_STATUS.NOT_READY){if(this.status===ADAPTER_STATUS.CONNECTED)throw WalletInitializationError.notReady("Already connected");if(this.status===ADAPTER_STATUS.READY)throw WalletInitializationError.notReady("Adapter is already initialized")}}},{key:"updateAdapterData",value:function(data){this.adapterData=data,this.emit(ADAPTER_EVENTS.ADAPTER_DATA_UPDATED,{adapterName:this.name,data:data})}}]),BaseAdapter}(openloginJrpc_esm.Ue),authServer="https://authjs.web3auth.io",log=loglevel_default().getLogger("web3auth-logger");function storageAvailable(type){var storage,storageExists=!1,storageLength=0;try{storage=window[type],storageExists=!0,storageLength=storage.length;var x="__storage_test__";return storage.setItem(x,x),storage.removeItem(x),!0}catch(error){return!!(error&&(22===error.code||1014===error.code||"QuotaExceededError"===error.name||"NS_ERROR_DOM_QUOTA_REACHED"===error.name)&&storageExists&&0!==storageLength)}}var checkIfTokenIsExpired=function(token){var decoded=(0,jwt_decode_esm.Z)(token);return!!(!decoded.exp||decoded.exp<Math.floor(Date.now()/1e3))},signChallenge=(_ref=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee(payload,chainNamespace){var data,res;return regenerator_default().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return data={payload:payload,header:{t:"solana"===chainNamespace?"sip99":"eip191"},network:"solana"===chainNamespace?"solana":"ethereum"},_context.next=6,(0,httpHelpers_esm.v_)("".concat(authServer,"/siww/get"),data);case 6:if((res=_context.sent).success){_context.next=9;break}throw Error("Failed to authenticate user, Please reach out to Web3Auth Support team");case 9:return _context.abrupt("return",res.challenge);case 10:case"end":return _context.stop()}},_callee)})),function(_x,_x2){return _ref.apply(this,arguments)}),verifySignedChallenge=(_ref2=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee2(chainNamespace,signedMessage,challenge,issuer,sessionTime,clientId){var sigData,idTokenRes;return regenerator_default().wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return sigData={signature:{s:signedMessage,t:"solana"===chainNamespace?"sip99":"eip191"},message:challenge,issuer:issuer,audience:window.location.hostname,timeout:sessionTime},_context2.next=4,(0,httpHelpers_esm.v_)("".concat(authServer,"/siww/verify"),sigData,{headers:{client_id:clientId,wallet_provider:issuer}});case 4:if((idTokenRes=_context2.sent).success){_context2.next=8;break}throw log.error("Failed to authenticate user, ,message verification failed",idTokenRes.error),Error("Failed to authenticate user, ,message verification failed");case 8:return _context2.abrupt("return",idTokenRes.token);case 9:case"end":return _context2.stop()}},_callee2)})),function(_x3,_x4,_x5,_x6,_x7,_x8){return _ref2.apply(this,arguments)}),MetamaskAdapter=function(_BaseEvmAdapter){(0,inherits.Z)(MetamaskAdapter,_BaseEvmAdapter);var hasNativeReflectConstruct,_init,_connect,_disconnect,_getUserInfo,_switchChain,_super=(hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var result,Super=(0,getPrototypeOf.Z)(MetamaskAdapter);if(hasNativeReflectConstruct){var NewTarget=(0,getPrototypeOf.Z)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,possibleConstructorReturn.Z)(this,result)});function MetamaskAdapter(adapterOptions){var _this;return(0,classCallCheck.Z)(this,MetamaskAdapter),_this=_super.call(this,adapterOptions),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"adapterNamespace",ADAPTER_NAMESPACES.EIP155),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"currentChainNamespace",CHAIN_NAMESPACES.EIP155),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"type",ADAPTER_CATEGORY.EXTERNAL),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"name",WALLET_ADAPTERS.METAMASK),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"status",ADAPTER_STATUS.NOT_READY),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"rehydrated",!1),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"metamaskProvider",null),_this.chainConfig=(null==adapterOptions?void 0:adapterOptions.chainConfig)||null,_this.sessionTime=(null==adapterOptions?void 0:adapterOptions.sessionTime)||86400,_this}return(0,createClass.Z)(MetamaskAdapter,[{key:"provider",get:function(){return this.status===ADAPTER_STATUS.CONNECTED&&this.metamaskProvider?this.metamaskProvider:null},set:function(_){throw Error("Not implemented")}},{key:"init",value:(_init=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee(options){return regenerator_default().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return(0,get.Z)((0,getPrototypeOf.Z)(MetamaskAdapter.prototype),"checkInitializationRequirements",this).call(this),_context.next=3,dist_default()({mustBeMetaMask:!0});case 3:if(this.metamaskProvider=_context.sent,this.metamaskProvider){_context.next=6;break}throw WalletInitializationError.notInstalled("Metamask extension is not installed");case 6:if(this.status=ADAPTER_STATUS.READY,this.emit(ADAPTER_EVENTS.READY,WALLET_ADAPTERS.METAMASK),_context.prev=8,log.debug("initializing metamask adapter"),!options.autoConnect){_context.next=14;break}return this.rehydrated=!0,_context.next=14,this.connect();case 14:_context.next=19;break;case 16:_context.prev=16,_context.t0=_context.catch(8),this.emit(ADAPTER_EVENTS.ERRORED,_context.t0);case 19:case"end":return _context.stop()}},_callee,this,[[8,16]])})),function(_x){return _init.apply(this,arguments)})},{key:"setAdapterSettings",value:function(options){this.status!==ADAPTER_STATUS.READY&&(null!=options&&options.sessionTime&&(this.sessionTime=options.sessionTime),null!=options&&options.clientId&&(this.clientId=options.clientId))}},{key:"connect",value:(_connect=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee2(){var _this2=this;return regenerator_default().wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if((0,get.Z)((0,getPrototypeOf.Z)(MetamaskAdapter.prototype),"checkConnectionRequirements",this).call(this),this.chainConfig||(this.chainConfig=getChainConfig(CHAIN_NAMESPACES.EIP155,1)),this.status=ADAPTER_STATUS.CONNECTING,this.emit(ADAPTER_EVENTS.CONNECTING,{adapter:WALLET_ADAPTERS.METAMASK}),this.metamaskProvider){_context2.next=6;break}throw WalletLoginError.notConnectedError("Not able to connect with metamask");case 6:return _context2.prev=6,_context2.next=9,this.metamaskProvider.request({method:"eth_requestAccounts"});case 9:if(!(this.metamaskProvider.chainId!==this.chainConfig.chainId)){_context2.next=13;break}return _context2.next=13,this.switchChain(this.chainConfig);case 13:if(this.status=ADAPTER_STATUS.CONNECTED,this.provider){_context2.next=16;break}throw WalletLoginError.notConnectedError("Failed to connect with provider");case 16:return this.provider.once("disconnect",function(){_this2.disconnect()}),this.emit(ADAPTER_EVENTS.CONNECTED,{adapter:WALLET_ADAPTERS.METAMASK,reconnected:this.rehydrated}),_context2.abrupt("return",this.provider);case 21:throw _context2.prev=21,_context2.t0=_context2.catch(6),this.status=ADAPTER_STATUS.READY,this.rehydrated=!1,this.emit(ADAPTER_EVENTS.ERRORED,_context2.t0),WalletLoginError.connectionError("Failed to login with metamask wallet");case 27:case"end":return _context2.stop()}},_callee2,this,[[6,21]])})),function(){return _connect.apply(this,arguments)})},{key:"disconnect",value:(_disconnect=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee3(){var _this$provider,options,_args3=arguments;return regenerator_default().wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return options=_args3.length>0&&void 0!==_args3[0]?_args3[0]:{cleanup:!1},_context3.next=3,(0,get.Z)((0,getPrototypeOf.Z)(MetamaskAdapter.prototype),"disconnect",this).call(this);case 3:null===(_this$provider=this.provider)||void 0===_this$provider||_this$provider.removeAllListeners(),options.cleanup?(this.status=ADAPTER_STATUS.NOT_READY,this.metamaskProvider=null):this.status=ADAPTER_STATUS.READY,this.rehydrated=!1,this.emit(ADAPTER_EVENTS.DISCONNECTED);case 7:case"end":return _context3.stop()}},_callee3,this)})),function(){return _disconnect.apply(this,arguments)})},{key:"getUserInfo",value:(_getUserInfo=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee4(){return regenerator_default().wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!(this.status!==ADAPTER_STATUS.CONNECTED)){_context4.next=2;break}throw WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");case 2:return _context4.abrupt("return",{});case 3:case"end":return _context4.stop()}},_callee4,this)})),function(){return _getUserInfo.apply(this,arguments)})},{key:"switchChain",value:(_switchChain=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee5(chainConfig){return regenerator_default().wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(this.metamaskProvider){_context5.next=2;break}throw WalletLoginError.notConnectedError("Not connected with wallet");case 2:return _context5.prev=2,_context5.next=5,this.metamaskProvider.request({method:"wallet_switchEthereumChain",params:[{chainId:chainConfig.chainId}]});case 5:case 12:_context5.next=15;break;case 7:if(_context5.prev=7,_context5.t0=_context5.catch(2),4902!==_context5.t0.code){_context5.next=14;break}return _context5.next=12,this.metamaskProvider.request({method:"wallet_addEthereumChain",params:[{chainId:chainConfig.chainId,chainName:chainConfig.displayName,rpcUrls:[chainConfig.rpcTarget]}]});case 14:throw _context5.t0;case 15:case"end":return _context5.stop()}},_callee5,this,[[2,7]])})),function(_x2){return _switchChain.apply(this,arguments)})}]),MetamaskAdapter}(function(_BaseAdapter){(0,inherits.Z)(BaseEvmAdapter,_BaseAdapter);var hasNativeReflectConstruct,_authenticateUser,_disconnect,_super=(hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var result,Super=(0,getPrototypeOf.Z)(BaseEvmAdapter);if(hasNativeReflectConstruct){var NewTarget=(0,getPrototypeOf.Z)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,possibleConstructorReturn.Z)(this,result)});function BaseEvmAdapter(){var _this,params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,classCallCheck.Z)(this,BaseEvmAdapter),_this=_super.call(this),(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"clientId",void 0),_this.clientId=params.clientId,_this}return(0,createClass.Z)(BaseEvmAdapter,[{key:"authenticateUser",value:(_authenticateUser=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee(){var _this$chainConfig,_this$chainConfig2,chainNamespace,chainId,accounts,existingToken,payload,challenge,signedMessage,idToken;return regenerator_default().wrap(function(_context){for(var userAddress,issuer,userAddress1,issuer1;;)switch(_context.prev=_context.next){case 0:if(!(!this.provider||!(null!==(_this$chainConfig=this.chainConfig)&&void 0!==_this$chainConfig&&_this$chainConfig.chainId))){_context.next=2;break}throw WalletLoginError.notConnectedError();case 2:if(chainNamespace=(_this$chainConfig2=this.chainConfig).chainNamespace,chainId=_this$chainConfig2.chainId,!(this.status!==ADAPTER_STATUS.CONNECTED)){_context.next=5;break}throw WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");case 5:return _context.next=7,this.provider.request({method:"eth_accounts"});case 7:if(!((accounts=_context.sent)&&accounts.length>0)){_context.next=26;break}if(userAddress=accounts[0],issuer=this.name,!(existingToken=storageAvailable("localStorage")?localStorage.getItem("".concat(userAddress.toLowerCase(),"_").concat(issuer)):null)||checkIfTokenIsExpired(existingToken)){_context.next=14;break}return _context.abrupt("return",{idToken:existingToken});case 14:return payload={domain:window.location.origin,uri:window.location.href,address:accounts[0],chainId:parseInt(chainId,16),version:"1",nonce:Math.random().toString(36).slice(2),issuedAt:new Date().toISOString()},_context.next=17,signChallenge(payload,chainNamespace);case 17:return challenge=_context.sent,_context.next=20,this.provider.request({method:"personal_sign",params:[challenge,accounts[0]]});case 20:return signedMessage=_context.sent,_context.next=23,verifySignedChallenge(chainNamespace,signedMessage,challenge,this.name,this.sessionTime,this.clientId);case 23:return idToken=_context.sent,userAddress1=accounts[0],issuer1=this.name,storageAvailable("localStorage")&&localStorage.setItem("".concat(userAddress1.toLowerCase(),"_").concat(issuer1),idToken),_context.abrupt("return",{idToken:idToken});case 26:throw WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");case 27:case"end":return _context.stop()}},_callee,this)})),function(){return _authenticateUser.apply(this,arguments)})},{key:"disconnect",value:(_disconnect=(0,asyncToGenerator.Z)(regenerator_default().mark(function _callee2(){var accounts;return regenerator_default().wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!(this.status!==ADAPTER_STATUS.CONNECTED)){_context2.next=2;break}throw WalletLoginError.disconnectionError("Not connected with wallet");case 2:return _context2.next=4,this.provider.request({method:"eth_accounts"});case 4:if((accounts=_context2.sent)&&accounts.length>0){var userAddress,issuer;userAddress=accounts[0],issuer=this.name,storageAvailable("localStorage")&&localStorage.removeItem("".concat(userAddress.toLowerCase(),"_").concat(issuer))}case 6:case"end":return _context2.stop()}},_callee2,this)})),function(){return _disconnect.apply(this,arguments)})}]),BaseEvmAdapter}(BaseAdapter))}}]);